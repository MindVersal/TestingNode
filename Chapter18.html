<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Chapter 18.</title>
</head>
<body>
<script>
    let req_1 = new XMLHttpRequest();
    req_1.open("GET", "example/data.txt", true);
    req_1.addEventListener("load", function () {
        console.log("Status: ", req_1.status);
        console.log("Done: ", req_1.responseText);
    });
    req_1.send(null);

    let req_2 = new XMLHttpRequest();
    req_2.open("GET", "example/fruit.xml", true);
    req_2.addEventListener("load", function () {
        console.log("Length Fruit: ",req_2.responseXML.querySelectorAll("fruit").length);
    });
    req_2.send(null);

    let req_3 = new XMLHttpRequest();
    req_3.open("GET", "example/fruit.json", true);
    req_3.addEventListener("load", function () {
        console.log("Response on JSON: ", JSON.parse(req_3.responseText));
    });
    req_3.send(null);

    function backgroundReadFile(url, callback) {
        let req = new XMLHttpRequest();
        req.open("GET", url, true);
        req.addEventListener("load", function () {
            if (req.status < 400){
                callback(req.responseText);
            }
        });
        req.send(null);
    }
    function getURL(url, callback) {
        let req = new XMLHttpRequest();
        req.open("GET", url, true);
        req.addEventListener("load", function () {
            if (req.status < 400){
                callback(req.responseText);
            } else {
                callback(null, new Error("Request failed: " + req.statusText));
            }
        });
        req.addEventListener("error", function () {
            callback(null, new Error("Network error"));
        });
        req.send(null);
    }
    getURL("data/nonsense.txt", function (context, error) {
        if (error !== null){
            console.log("Failed to fetch nonsense.txt: " + error);
        } else {
            console.log("nonsense.txt: " + context);
        }
    });
    function get(url) {
        return new Promise(function (success, fail) {
            let req = new XMLHttpRequest();
            req.open("GET", url, true);
            req.addEventListener("load", function () {
                if (req.status < 400){
                    success(req.responseText);
                } else {
                    fail(new Error("Request failed: " + req.statusText));
                }
            });
            req.addEventListener("error", function () {
                fail(new Error("Network error."));
            });
            req.send(null);
        });
    }
    get("example/data.txt").then(function (text) {
        console.log("data.txt: " + text);
    }, function (error) {
        console.log("Failed to fetch data.txt: " + error);
    });

</script>














</body>
</html>